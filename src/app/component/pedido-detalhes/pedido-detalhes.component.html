<div class="card shadow-sm">
  <div class="card-header bg-white">
    <h5 class="mb-0">Detalhes do Pedido</h5>
  </div>
  
  <div class="card-body text-center py-5" *ngIf="isLoading">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
  </div>

  <div class="card-body" *ngIf="!isLoading && pedido">
    <div class="mb-3">
      <p class="mb-1 text-muted small">Informações do Pedido</p>
      <p class="mb-1"><strong>ID:</strong> #{{ pedido.id.substring(0, 8) }}</p>
      <p class="mb-1">
        <strong>Status:</strong> 
        <span class="badge" [ngClass]="getStatusBadgeClass(pedido.status)">
          {{ pedido.status }}
        </span>
      </p>
      <p class="mb-0"><strong>Data:</strong> {{ formatarData(pedido.dataCriacao) }}</p>
    </div>

    <hr>

    <h6 class="mb-3">Itens do Pedido</h6>
    <div class="table-responsive" *ngIf="pedido.itens && pedido.itens.length > 0; else semItens">
      <table class="table table-sm">
        <thead class="table-light">
          <tr>
            <th>Produto ID</th>
            <th>Qtd</th>
            <th>Preço Unit.</th>
            <th>Subtotal</th>
            <th class="text-center">Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of pedido.itens">
            <td>#{{ item.produtoId.slice(-3) }}</td>
            <td>{{ item.quantidade }}</td>
            <td>{{ item.precoUnitario | currency:'BRL' }}</td>
            <td>{{ (item.quantidade * item.precoUnitario) | currency:'BRL' }}</td>
            <td class="text-center">
              <button class="btn btn-sm btn-outline-danger" 
                      (click)="onRemoverItem(item.itemId)"
                      [disabled]="isPedidoFechado()"
                      title="Remover item">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <ng-template #semItens>
      <div class="alert alert-info">
        <i class="bi bi-info-circle"></i> Este pedido não possui itens ainda.
      </div>
    </ng-template>

    <hr>

    <div class="d-flex justify-content-between align-items-center mb-3">
      <h6 class="mb-0">Total:</h6>
      <h5 class="mb-0 text-success">{{ calcularTotal() | currency:'BRL' }}</h5>
    </div>

    <div class="d-grid gap-2">
      <button class="btn btn-primary" 
              (click)="onAdicionarItens()"
              [disabled]="isPedidoFechado()">
        <i class="bi bi-plus-circle"></i> ADICIONAR ITENS AO PEDIDO
      </button>
      <button class="btn btn-success" 
              (click)="onFecharPedido()"
              [disabled]="isPedidoFechado()">
        <i class="bi bi-check-circle"></i> FECHAR PEDIDO
      </button>
      <button class="btn btn-danger" (click)="onCancelar()">
        <i class="bi bi-x-circle"></i> CANCELAR PEDIDO
      </button>
    </div>
  </div>

  <div class="card-body text-center text-muted py-5" *ngIf="!isLoading && !pedido">
    <i class="bi bi-inbox" style="font-size: 3rem;"></i>
    <p class="mt-3">Selecione um pedido para ver os detalhes</p>
  </div>
</div>
